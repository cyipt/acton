---
title: "Acton case studies"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Acton case studies}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, include=FALSE}
library(acton)
library(tmap)
tmap_mode("view")
```

## Leeds



### Planning applications

Using data from [PlanIt](https://www.planit.org.uk/), we have identified four recent planning applications with approval for >100 homes. 

Allerton Bywater Millennium Community:

- one of a series of Millennium Communities, the development at Allerton Bywater was announced by John Prescott in 1998. The homes lie on the site of Allerton Colliery, which was the last remaining colliery in Leeds when it closed in 1995. The aim was to incorporate the whole of Allerton Bywater village in the project, rather than solely focusing on the site itself. For example, a £500,000 community fund was made available to the parish council to spend on local projects, and community buildings in the village were also refurbished. In total there was £24 million upfront public investment by English Partnerships and the HCA. This included drainage, site clearance and decontamination. The development incorporates high environmental standards for both the homes and the new industrial units, and a number of homes built under a 'Design for Manufacture' competition for a construction cost of no more than £60,000.

- in total there are 562 homes in the Millennium Community. The final phase includes 189 homes and has planning consent 13/05235/FU. A sustrans cycle route passes through the site, which is designed as a HomeZone with shared space streets, although these tend to fill up with parked cars. However, plans for buses to be routed through the site did not materialise. The village lies six miles southeast of Leeds and the buses to Leeds run every 30 minutes. 

Leeds Climate Innovation District:

- situated on the banks of the River Aire, close to Leeds city centre, this development is built around high environmental standards including low carbon timber-framed homes with high levels of insulation and a Mechanical Ventilation Heat Recovery System preventing the need for gas central heating. The homes will be served by solar panels on-site via a private-wire network; a Community Interest Company will be set up that will own the utility cooperative. 

- a new foot/cycle bridge has been erected over the River Aire to connect the two halves of the site and allow a traffic-free route into the city centre. On-site car parking is in an undercroft; spaces have to be purchased at a cost of £15,000.  

- in total there will be over 520 new homes. Phase 1 to the north of the river will contain 312 dwellings, with planning consent 15/00415/FU. 

Micklefield:

- planning consent 15/01973/FU is for a development of 292 residential dwellings in the village of Micklefield. The S106 agreement included £8000 for cycle facilities at nearby Micklefield station. 

Tyersall:

- although the site lies within Leeds it is actually closer to Bradford, and the only road access is to west, via the Bradford suburbs of .

```{r}

```

### Accessibility indicators

```{r}
# library(dplyr)
# work_accesibility = get_jts_data(table = "jts0501", year = 2017)
# jts_0501_metadata = get_jts_data(table = "jts0501", year = "Metadata")
# # View(jts_0501_metadata)
# wy_zones = pct::get_pct_zones(region = "west-yorkshire", geography = "lsoa")
# # names(work_accesibility)
# names(work_accesibility)[1] = names(wy_zones)[1]
# zones = dplyr::left_join(wy_zones, work_accesibility)
# zones_leeds = zones %>% filter(lad_name == "Leeds")
# plot(zones_leeds["100EmpPTt"])
# plot(zones_leeds["Empl_pop"])
# plot(zones_leeds$all, zones_leeds$Empl_pop)
# sf::write_sf(zones_leeds, "zones_leeds_pct_jts_2017_lsoa.geojson")
# piggyback::pb_upload("zones_leeds_pct_jts_2017_lsoa.geojson")
# piggyback::pb_download_url("zones_leeds_pct_jts_2017_lsoa.geojson")
zones_leeds = sf::read_sf("https://github.com/cyipt/acton/releases/download/0.0.1/zones_leeds_pct_jts_2017_lsoa.geojson")
qtm(zones_leeds, "Empl_pop")
```

According to DfT's JTS, there are many areas that have poor accessibility by active modes and public transport.

```{r}
# names(zones_leeds)
tmap_mode("plot")
qtm(zones_leeds, c("Jobs5000EmpPTt", "Jobs5000EmpCyct", "Jobs5000EmpCart")) +
  tm_facets(nrow = 1)
```

## Route busyness

```{r}
library(stplanr)
od_from_zone1 = data.frame(
  stringsAsFactors = TRUE,
  origin = zones_leeds$geo_code[1],
  destination = zones_leeds$geo_code[2:9]
)
desire_lines = od2line(flow = od_from_zone1, zones_leeds)
plot(desire_lines)
```

```{r, eval=FALSE}
routes_fastest = route(
  l = desire_lines,
  route_fun = cyclestreets::journey,
  plan = "fastest" # on CRAN version only fastest works
  )
```

```{r, eval=FALSE, echo=FALSE}
# save roues_fastest object
saveRDS(routes_fastest, "routes_fastest.Rds")
piggyback::pb_upload("routes_fastest.Rds")
piggyback::pb_download_url("routes_fastest.Rds")
```

```{r, echo=FALSE}
routes_fastest = readRDS(url("https://github.com/cyipt/acton/releases/download/0.0.1/routes_fastest.Rds"))
```


```{r plot-fast-routes}
routes_fastest$busyness = routes_fastest$busynance / routes_fastest$distances
plot(routes_fastest["busyness"])
```


